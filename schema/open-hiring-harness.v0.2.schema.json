{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/open-hiring-harness.v0.2.schema.json",
  "title": "Open Hiring Harness",
  "type": "object",
  "required": ["version", "identity", "offer", "availability", "privacy", "consent", "requester_policy"],
  "additionalProperties": false,

  "$defs": {
    "Visibility": { "type": "string", "enum": ["public", "permissioned", "private"] },

    "Envelope": {
      "type": "object",
      "required": ["visibility", "data"],
      "additionalProperties": false,
      "properties": {
        "visibility": { "$ref": "#/$defs/Visibility" },
        "cache_ttl_minutes": { "type": "integer", "minimum": 0, "maximum": 10080, "default": 0 },
        "scopes_required": { "type": "array", "items": { "type": "string", "minLength": 3 }, "default": [] },
        "data": {}
      }
    },

    "Locality": {
      "type": "object",
      "required": ["country"],
      "additionalProperties": false,
      "properties": {
        "city": { "type": "string" },
        "region": { "type": "string" },
        "country": { "type": "string", "minLength": 2, "maxLength": 2, "description": "ISO 3166-1 alpha-2" }
      }
    },

    "Links": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "website": { "type": "string" },
        "portfolio": { "type": "string" },
        "linkedin": { "type": "string" },
        "github": { "type": "string" },
        "calendar_booking": { "type": "string" }
      },
      "default": {}
    },

    "ContactPublic": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "public_email": { "type": "string" },
        "contact_form": { "type": "string" }
      },
      "default": {}
    },

    "Skill": {
      "type": "object",
      "required": ["name", "level"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "minLength": 2, "maxLength": 80 },
        "level": { "type": "string", "enum": ["aware", "working", "strong", "expert"] },
        "evidence": { "type": "array", "items": { "type": "string" }, "default": [] }
      }
    },

    "Service": {
      "type": "object",
      "required": ["id", "name", "description", "outcomes", "typical_duration_days"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "pattern": "^[a-z0-9_\\-]{3,48}$" },
        "name": { "type": "string", "minLength": 2, "maxLength": 80 },
        "description": { "type": "string", "minLength": 10, "maxLength": 800 },
        "outcomes": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "typical_duration_days": { "type": "integer", "minimum": 1, "maximum": 180 },
        "delivery_mode": {
          "type": "array",
          "items": { "type": "string", "enum": ["remote", "onsite", "hybrid"] },
          "default": ["remote"]
        },
        "min_engagement_days": { "type": "integer", "minimum": 1, "maximum": 365, "default": 1 },
        "constraints": { "type": "array", "items": { "type": "string" }, "default": [] }
      }
    },

    "RateUnit": {
      "type": "object",
      "required": ["unit", "amount"],
      "additionalProperties": false,
      "properties": {
        "unit": { "type": "string", "enum": ["hour", "day", "week", "project"] },
        "amount": { "type": "number", "minimum": 0 },
        "notes": { "type": "string", "maxLength": 240, "default": "" }
      }
    },

    "RatesData": {
      "type": "object",
      "required": ["currency", "units"],
      "additionalProperties": false,
      "properties": {
        "currency": { "type": "string", "minLength": 3, "maxLength": 3, "description": "ISO 4217" },
        "units": { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/RateUnit" } },
        "rate_rules": { "type": "array", "items": { "type": "string" }, "default": [] }
      }
    },

    "AvailabilitySummaryData": {
      "type": "object",
      "required": ["status", "weekly_capacity_hours"],
      "additionalProperties": false,
      "properties": {
        "status": { "type": "string", "enum": ["open", "limited", "closed"] },
        "weekly_capacity_hours": { "type": "integer", "minimum": 0, "maximum": 80 },
        "available_from": { "type": ["string", "null"], "format": "date", "default": null }
      }
    },

    "BlackoutRange": {
      "type": "object",
      "required": ["start_date", "end_date"],
      "additionalProperties": false,
      "properties": {
        "start_date": { "type": "string", "format": "date" },
        "end_date": { "type": "string", "format": "date" },
        "reason": { "type": "string", "maxLength": 120, "default": "" }
      }
    },

    "AvailabilityDetailData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "notes": { "type": "string", "maxLength": 400, "default": "" },
        "blackout_ranges": { "type": "array", "items": { "$ref": "#/$defs/BlackoutRange" }, "default": [] }
      },
      "default": {}
    },

    "CaseStudy": {
      "type": "object",
      "required": ["title", "url"],
      "additionalProperties": false,
      "properties": {
        "title": { "type": "string" },
        "url": { "type": "string" },
        "tags": { "type": "array", "items": { "type": "string" }, "default": [] }
      }
    },

    "ProofData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "case_studies": { "type": "array", "items": { "$ref": "#/$defs/CaseStudy" }, "default": [] },
        "credentials": { "type": "array", "items": { "type": "string" }, "default": [] }
      },
      "default": {}
    },

    "IssuerVerification": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "method": { "type": "string", "enum": ["none", "email_domain", "signature"], "default": "none" },
        "proof": { "type": "string", "default": "" }
      },
      "default": { "method": "none", "proof": "" }
    },

    "EndorsementIssuer": {
      "type": "object",
      "required": ["name"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "maxLength": 120 },
        "org": { "type": "string", "maxLength": 120, "default": "" },
        "contact": { "type": "string", "maxLength": 200, "default": "" },
        "verification": { "$ref": "#/$defs/IssuerVerification" }
      }
    },

    "Endorsement": {
      "type": "object",
      "required": ["id", "statement", "issuer", "issued_at", "redaction_level"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "pattern": "^[a-z0-9_\\-]{8,64}$" },
        "statement": { "type": "string", "minLength": 20, "maxLength": 800 },
        "issuer": { "$ref": "#/$defs/EndorsementIssuer" },
        "scope_tags": { "type": "array", "items": { "type": "string" }, "default": [] },
        "issued_at": { "type": "string", "format": "date-time" },
        "redaction_level": { "type": "string", "enum": ["none", "partial", "full"] }
      }
    },

    "ReputationClaim": {
      "type": "object",
      "required": ["type", "value", "evidence"],
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "enum": ["projects_completed", "repeat_clients", "years_experience"] },
        "value": { "type": "number", "minimum": 0 },
        "evidence": { "type": "string", "maxLength": 240 }
      }
    },

    "ReputationRedactedData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "endorsements": { "type": "array", "items": { "$ref": "#/$defs/Endorsement" }, "default": [] },
        "claims": { "type": "array", "items": { "$ref": "#/$defs/ReputationClaim" }, "default": [] }
      },
      "default": {}
    },

    "ReputationFullData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "endorsements": { "type": "array", "items": { "$ref": "#/$defs/Endorsement" }, "default": [] },
        "claims": { "type": "array", "items": { "$ref": "#/$defs/ReputationClaim" }, "default": [] }
      },
      "default": {}
    },

    "RequesterIdentity": {
      "type": "object",
      "required": ["id", "name", "type"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "minLength": 3, "maxLength": 96 },
        "name": { "type": "string", "minLength": 2, "maxLength": 160 },
        "type": { "type": "string", "enum": ["platform", "agent", "client", "individual"] },
        "website": { "type": "string", "default": "" }
      }
    },

    "ConsentReceipt": {
      "type": "object",
      "required": ["receipt_version", "receipt_id", "granted_to", "purpose", "scopes", "issued_at", "expires_at", "cache_ttl_minutes", "revocable"],
      "additionalProperties": false,
      "properties": {
        "receipt_version": { "type": "string", "const": "consent_receipt_v1" },
        "receipt_id": { "type": "string", "pattern": "^cr_[a-z0-9]{6,32}$" },
        "granted_to": { "$ref": "#/$defs/RequesterIdentity" },
        "purpose": { "type": "string", "minLength": 8, "maxLength": 320 },
        "scopes": { "type": "array", "minItems": 1, "items": { "type": "string", "minLength": 3 } },
        "issued_at": { "type": "string", "format": "date-time" },
        "expires_at": { "type": "string", "format": "date-time" },
        "cache_ttl_minutes": { "type": "integer", "minimum": 0, "maximum": 10080 },
        "revocable": { "type": "boolean" }
      }
    }
  },

  "properties": {
    "version": { "type": "string", "const": "0.2.0" },

    "identity": {
      "type": "object",
      "required": ["handle", "display_name", "time_zone", "locality"],
      "additionalProperties": false,
      "properties": {
        "handle": { "type": "string", "pattern": "^[a-zA-Z0-9_\\-\\.]{3,64}$" },
        "display_name": { "type": "string", "minLength": 2, "maxLength": 120 },
        "tagline": { "type": "string", "maxLength": 160 },
        "time_zone": { "type": "string", "minLength": 3, "maxLength": 64 },
        "locality": { "$ref": "#/$defs/Locality" },
        "languages": { "type": "array", "items": { "type": "string", "minLength": 2, "maxLength": 32 }, "default": [] },
        "links": { "$ref": "#/$defs/Links" },

        "contact": {
          "allOf": [
            { "$ref": "#/$defs/Envelope" },
            {
              "properties": {
                "data": { "$ref": "#/$defs/ContactPublic" }
              }
            }
          ],
          "default": { "visibility": "private", "cache_ttl_minutes": 0, "scopes_required": ["read:contact"], "data": {} }
        }
      }
    },

    "offer": {
      "type": "object",
      "required": ["roles", "specialties", "services", "rates"],
      "additionalProperties": false,
      "properties": {
        "roles": { "type": "array", "minItems": 1, "items": { "type": "string", "minLength": 2, "maxLength": 64 } },
        "specialties": { "type": "array", "items": { "type": "string", "minLength": 2, "maxLength": 80 }, "default": [] },
        "skills": { "type": "array", "items": { "$ref": "#/$defs/Skill" }, "default": [] },
        "services": { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/Service" } },

        "rates": {
          "allOf": [
            { "$ref": "#/$defs/Envelope" },
            {
              "properties": {
                "data": { "$ref": "#/$defs/RatesData" }
              }
            }
          ]
        },

        "industries": { "type": "array", "items": { "type": "string" }, "default": [] },
        "working_preferences": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "client_types": { "type": "array", "items": { "type": "string" }, "default": [] },
            "team_modes": { "type": "array", "items": { "type": "string" }, "default": [] }
          },
          "default": {}
        }
      }
    },

    "availability": {
      "type": "object",
      "required": ["summary", "detail"],
      "additionalProperties": false,
      "properties": {
        "summary": {
          "allOf": [
            { "$ref": "#/$defs/Envelope" },
            { "properties": { "data": { "$ref": "#/$defs/AvailabilitySummaryData" } } }
          ]
        },
        "detail": {
          "allOf": [
            { "$ref": "#/$defs/Envelope" },
            { "properties": { "data": { "$ref": "#/$defs/AvailabilityDetailData" } } }
          ]
        }
      }
    },

    "proof": {
      "allOf": [
        { "$ref": "#/$defs/Envelope" },
        { "properties": { "data": { "$ref": "#/$defs/ProofData" } } }
      ],
      "default": { "visibility": "public", "cache_ttl_minutes": 10080, "scopes_required": [], "data": {} }
    },

    "reputation": {
      "type": "object",
      "required": ["redacted", "full"],
      "additionalProperties": false,
      "properties": {
        "redacted": {
          "allOf": [
            { "$ref": "#/$defs/Envelope" },
            { "properties": { "data": { "$ref": "#/$defs/ReputationRedactedData" } } }
          ]
        },
        "full": {
          "allOf": [
            { "$ref": "#/$defs/Envelope" },
            { "properties": { "data": { "$ref": "#/$defs/ReputationFullData" } } }
          ]
        }
      }
    },

    "privacy": {
      "type": "object",
      "required": ["default_visibility", "indexing", "caching", "rate_limits", "contact_protection"],
      "additionalProperties": false,
      "properties": {
        "default_visibility": { "$ref": "#/$defs/Visibility" },

        "indexing": {
          "type": "object",
          "required": ["allow", "robots_policy", "allow_search_engines"],
          "additionalProperties": false,
          "properties": {
            "allow": { "type": "boolean" },
            "robots_policy": { "type": "string", "enum": ["allow", "disallow"] },
            "allow_search_engines": { "type": "boolean" }
          }
        },

        "caching": {
          "type": "object",
          "required": ["public_ttl_minutes", "permissioned_ttl_minutes", "private_ttl_minutes"],
          "additionalProperties": false,
          "properties": {
            "public_ttl_minutes": { "type": "integer", "minimum": 0, "maximum": 10080 },
            "permissioned_ttl_minutes": { "type": "integer", "minimum": 0, "maximum": 10080 },
            "private_ttl_minutes": { "type": "integer", "minimum": 0, "maximum": 10080 }
          }
        },

        "rate_limits": {
          "type": "object",
          "required": ["anonymous_per_minute", "identified_per_minute"],
          "additionalProperties": false,
          "properties": {
            "anonymous_per_minute": { "type": "integer", "minimum": 1, "maximum": 600 },
            "identified_per_minute": { "type": "integer", "minimum": 1, "maximum": 5000 }
          }
        },

        "contact_protection": {
          "type": "object",
          "required": ["expose_email", "expose_calendar_link", "preferred_lead_routing"],
          "additionalProperties": false,
          "properties": {
            "expose_email": { "type": "string", "enum": ["never", "permissioned", "public"] },
            "expose_calendar_link": { "type": "string", "enum": ["never", "permissioned", "public"] },
            "preferred_lead_routing": { "type": "string", "enum": ["email", "calendar", "webhook"] }
          }
        }
      }
    },

    "consent": {
      "type": "object",
      "required": ["required_for", "grant_modes", "max_standing_grant_days", "receipt_format", "revocation"],
      "additionalProperties": false,
      "properties": {
        "required_for": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Visibility" }
        },
        "grant_modes": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "enum": ["one_time", "timeboxed", "standing"] }
        },
        "max_standing_grant_days": { "type": "integer", "minimum": 1, "maximum": 365 },
        "receipt_format": { "type": "string", "const": "consent_receipt_v1" },
        "log_location": {
          "type": "string",
          "description": "Relative or absolute URL to the consent log file (recommended: separate from harness)",
          "default": ""
        },
        "revocation": {
          "type": "object",
          "required": ["supported", "endpoint"],
          "additionalProperties": false,
          "properties": {
            "supported": { "type": "boolean" },
            "endpoint": { "type": "string", "minLength": 5, "maxLength": 120 }
          }
        }
      }
    },

    "requester_policy": {
      "type": "object",
      "required": ["require_requester_identity", "require_purpose", "require_scopes", "deny_if_missing"],
      "additionalProperties": false,
      "properties": {
        "require_requester_identity": { "type": "boolean" },
        "require_purpose": { "type": "boolean" },
        "require_scopes": { "type": "boolean" },
        "deny_if_missing": { "type": "boolean" }
      }
    },

    "consent_receipts": {
      "type": "array",
      "description": "Deprecated: prefer using a separate consent log file via consent.log_location",
      "items": { "$ref": "#/$defs/ConsentReceipt" },
      "default": []
    }
  }
}